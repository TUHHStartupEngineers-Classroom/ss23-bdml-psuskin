{
  "hash": "e13ffa3e9b3eeaaf8c92509bf58af599",
  "result": {
    "markdown": "---\ntitle: \"Data Acquisition\"\nauthor: \"Joschka Schwarz\"\n---\n\n\n# Libraries\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-1_5b92959e7700ec197d4ab0461894a0ef'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidyquant)\nlibrary(recipes)\nlibrary(workflows)\nlibrary(rsample)\nlibrary(parsnip)\n```\n:::\n\n\n# Data preparation\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-2_e1fac5c08f2338188e5799f1d77da416'}\n\n```{.r .cell-code}\nbike_orderlines_tbl <- read_rds(\"../../Business Decisions with Machine Learning/bike_orderlines.rds\")\n\nsales_tbl <- bike_orderlines_tbl %>%\n  select(total_price, model, category_2, frame_material) %>%\n  group_by(model, category_2, frame_material) %>%\n  summarise(total_sales = sum(total_price)) %>%\n  ungroup() %>%\n  arrange(desc(total_sales))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `summarise()` has grouped output by 'model', 'category_2'. You can override\n#> using the `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nsales_tbl %>%\n  mutate(category_2 = as_factor(category_2) %>%\n           fct_reorder(total_sales, .fun = max) %>%\n           fct_rev()) %>%\n  ggplot(aes(frame_material, total_sales)) +\n  geom_violin() +\n  geom_jitter(width = 0.1, alpha = 0.5, color = \"#2c3e50\") +\n  facet_wrap(~ category_2) +\n  scale_y_continuous(labels = scales::dollar_format(scale = 1e-6, suffix = \"M\", accuracy = 0.1)) +\n  theme_tq() +\n  labs(\n      title = \"Total Sales for Each Model\",\n      x = \"Frame Material\", y = \"Revenue\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Groups with fewer than two data points have been dropped.\n#> Groups with fewer than two data points have been dropped.\n#> Groups with fewer than two data points have been dropped.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in max(data$density): no non-missing arguments to max; returning -Inf\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Computation failed in `stat_ydensity()`\n#> Caused by error in `$<-.data.frame`:\n#> ! replacement has 1 row, data has 0\n```\n:::\n\n::: {.cell-output-display}\n![](02_data_acquisition_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n# Recipe\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-3_d1a1d3da2ffcc60e6345947592d74f53'}\n\n```{.r .cell-code}\nrecipe_obj <- recipe(price ~ frame_material + category_2 + model, data = bike_orderlines_tbl) %>%\n  step_dummy(all_nominal(), -frame_material, -category_2, -model, one_hot = T) %>%\n  prep()\n```\n:::\n\n\n# Training and testing data\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-4_216f1805cdea5875cb2d045d474330ec'}\n\n```{.r .cell-code}\nbike_orderlines_tbl %>% distinct(category_2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"category_2\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Trail\"},{\"1\":\"Race\"},{\"1\":\"Triathlon Bike\"},{\"1\":\"Dirt Jump\"},{\"1\":\"City\"},{\"1\":\"Cyclocross\"},{\"1\":\"Enduro\"},{\"1\":\"E-Mountain\"},{\"1\":\"All-Road\"},{\"1\":\"Endurance\"},{\"1\":\"E-City\"},{\"1\":\"Cross-Country\"},{\"1\":\"Touring\"},{\"1\":\"E-Gravel\"},{\"1\":\"Adventure\"},{\"1\":\"Downhill\"},{\"1\":\"Fat Bikes\"},{\"1\":\"E-Fitness\"},{\"1\":\"E-Trekking\"},{\"1\":\"E-Road\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nset.seed(1113)\n\nsplit_obj <- rsample::initial_split(bike_orderlines_tbl, prop = 0.8, strata = \"category_2\")\nsplit_obj %>% training() %>% distinct(category_2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"category_2\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Triathlon Bike\"},{\"1\":\"Dirt Jump\"},{\"1\":\"City\"},{\"1\":\"Enduro\"},{\"1\":\"E-Mountain\"},{\"1\":\"Endurance\"},{\"1\":\"E-City\"},{\"1\":\"Touring\"},{\"1\":\"Cross-Country\"},{\"1\":\"E-Gravel\"},{\"1\":\"E-Fitness\"},{\"1\":\"Cyclocross\"},{\"1\":\"Downhill\"},{\"1\":\"E-Trekking\"},{\"1\":\"All-Road\"},{\"1\":\"Fat Bikes\"},{\"1\":\"Adventure\"},{\"1\":\"E-Road\"},{\"1\":\"Race\"},{\"1\":\"Trail\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nsplit_obj %>% testing() %>% distinct(category_2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"category_2\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Triathlon Bike\"},{\"1\":\"Race\"},{\"1\":\"E-City\"},{\"1\":\"Trail\"},{\"1\":\"Cross-Country\"},{\"1\":\"Touring\"},{\"1\":\"E-Mountain\"},{\"1\":\"Dirt Jump\"},{\"1\":\"All-Road\"},{\"1\":\"E-Fitness\"},{\"1\":\"Endurance\"},{\"1\":\"Enduro\"},{\"1\":\"E-Trekking\"},{\"1\":\"Downhill\"},{\"1\":\"City\"},{\"1\":\"Fat Bikes\"},{\"1\":\"Cyclocross\"},{\"1\":\"E-Gravel\"},{\"1\":\"Adventure\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ntrain_tbl <- training(split_obj)\ntest_tbl  <- testing(split_obj)\n\ntrain_tbl <- train_tbl %>% set_names(str_replace_all(names(train_tbl), \" |-\", \"_\"))\ntest_tbl  <- test_tbl  %>% set_names(str_replace_all(names(test_tbl),  \" |-\", \"_\"))\n\ntrain_transformed_tbl <- bake(recipe_obj, new_data = train_tbl)\ntest_transformed_tbl <- bake(recipe_obj, new_data = test_tbl) \n```\n:::\n\n\n# Model\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-5_19ede6fbd6887a27115a2a1a4503c815'}\n\n```{.r .cell-code}\nmodel_reg_lm <- linear_reg(mode = \"regression\") %>% set_engine(\"lm\")\n```\n:::\n\n\n# Workflow\n\n\n::: {.cell hash='02_data_acquisition_cache/html/unnamed-chunk-6_56e9bd7518d756f9e9fa13ce41ef9388'}\n\n```{.r .cell-code}\nworkflow <- workflow(preprocessor = NULL, spec = NULL) %>% \n  workflows::add_recipe(recipe_obj) %>%\n  workflows::add_model(model_reg_lm)\n\nfitted_workflow <- fit(workflow, train_transformed_tbl)\n\nmetrics <- fitted_workflow %>%\n           predict(new_data = test_transformed_tbl) %>%\n           bind_cols(test_transformed_tbl %>% select(price)) %>%\n           yardstick::metrics(truth = price, estimate = .pred) %>% print()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> # A tibble: 3 Ã— 3\n#>   .metric .estimator .estimate\n#>   <chr>   <chr>          <dbl>\n#> 1 rmse    standard      56.0  \n#> 2 rsq     standard       0.999\n#> 3 mae     standard       7.40\n```\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}